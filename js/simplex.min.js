/*
This file is part of libnoise-dotnet.
libnoise-dotnet is free software: you can redistribute it and/or modify
it under the terms of the GNU Lesser General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

libnoise-dotnet is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License
along with libnoise-dotnet.  If not, see <http://www.gnu.org/licenses/>.

Simplex Noise in 2D, 3D and 4D. Based on the example code of this paper:
http://staffwww.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf

From Stefan Gustavson, Linkping University, Sweden (stegu at itn dot liu dot se)
From Karsten Schmidt (slight optimizations & restructuring)
Some changes by Sebastian Lague for use in a tutorial series.

Converted to javascript by Jussi Parviainen, code was written by using the Stegan Gustavson paper: Simplex noise demystified and also used Sebastian Lague tutorial on procedural planets for the noise seed.
*/
var _SIMPLEX_PERMUTATION=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],_SIMPLEX_GRAD3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],_SIMPLEX_F3=.33333333333,_SIMPLEX_G3=.16666666666;function Simplex(t=0){this.seed=t,this.perm=[],this.SetPermutation=function(){if(this.seed=Math.floor(this.seed),this.seed<0&&(this.seed=-this.seed),this.perm=[],0!==this.seed){var e=[255&this.seed,(65280&this.seed)>>8,(16711680&this.seed)>>16,(4278190080&this.seed)>>24];let t=0;for(;t<_SIMPLEX_PERMUTATION.length;)this.perm[t]=_SIMPLEX_PERMUTATION[t]^e[0],this.perm[t]^=e[1],this.perm[t]^=e[2],this.perm[t]^=e[3],this.perm[t+256]=this.perm[t],t++}else{let t=0;for(;t<512;)this.perm[t]=_SIMPLEX_PERMUTATION[t%255],t++}},this.SetPermutation(),this.SetSeed=function(t){this.seed=t,this.SetPermutation()},this.Evaluate=function(t,e,_){var s,i,h,r,M,P,E=0,S=(n1=0,n2=0,n3=0,(t+e+_)*_SIMPLEX_F3),I=Math.floor(t+S),L=Math.floor(e+S),S=Math.floor(_+S),X=(I+L+S)*_SIMPLEX_G3,t=t-(I-X),e=e-(L-X),_=_-(S-X),m=e<=t?_<=e?(M=r=s=1,h=i=0):r=_<=t?(M=h=i=0,s=1):(M=i=s=0,h=1):e<_?(r=i=s=0,M=h=1):t<_?(r=h=s=0,M=i=1):(M=r=i=1,h=s=0),n=t-s+_SIMPLEX_G3,p=e-i+_SIMPLEX_G3,o=_-h+_SIMPLEX_G3,G=t-r+_SIMPLEX_F3,A=e-M+_SIMPLEX_F3,R=_-m+_SIMPLEX_F3,a=t-.5,d=e-.5,f=_-.5,I=255&I,L=255&L,S=255&S;return 0<(X=.6-t*t-e*e-_*_)&&(P=this.perm[I+this.perm[L+this.perm[S]]]%12,E=(X*=X)*X*(_SIMPLEX_GRAD3[P][0]*t+_SIMPLEX_GRAD3[P][1]*e+_SIMPLEX_GRAD3[P][2]*_)),0<(X=.6-n*n-p*p-o*o)&&(P=this.perm[I+s+this.perm[L+i+this.perm[S+h]]]%12,n1=(X*=X)*X*(_SIMPLEX_GRAD3[P][0]*n+_SIMPLEX_GRAD3[P][1]*p+_SIMPLEX_GRAD3[P][2]*o)),0<(X=.6-G*G-A*A-R*R)&&(P=this.perm[I+r+this.perm[L+M+this.perm[S+m]]]%12,n2=(X*=X)*X*(_SIMPLEX_GRAD3[P][0]*G+_SIMPLEX_GRAD3[P][1]*A+_SIMPLEX_GRAD3[P][2]*R)),0<(X=.6-a*a-d*d-f*f)&&(P=this.perm[1+I+this.perm[1+L+this.perm[1+S]]]%12,n3=(X*=X)*X*(_SIMPLEX_GRAD3[P][0]*a+_SIMPLEX_GRAD3[P][1]*d+_SIMPLEX_GRAD3[P][2]*f)),32*(E+n1+n2+n3)},this.FBM=function(t=0,e=0,_=0,s=4,i=.05,h=2,r=.5,M=0,P=0,E=0,S=0,I=!0){var L,X=0,m=0,n=0,p=0,o=i,G=1;let A=s=s<1?1:s;for(;A--;)X+=.5*((L=this.Evaluate(o*t+M,o*e+P,o*_+E))+1)*G,m+=(1-(L=0<L?L:-L))*(1-L)*G,n+=L*G,p+=+G,o*=h,G*=r;return 1==S?I?m/p:m:2==S?I?n/p:n:I?X/p:X}}